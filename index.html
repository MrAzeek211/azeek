<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data Pasal</title>
<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;padding:20px}
h2,h3{margin-top:20px}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#222;color:#fff}
button{padding:5px 10px;cursor:pointer;margin:2px}
.summary{background:#fff;padding:10px;border:1px solid #ccc;margin-top:15px}
.history{background:#fff;padding:10px;border:1px solid #ccc;margin-top:15px;max-height:200px;overflow:auto}
</style>
</head>
<body>

<h2>Data Pasal</h2>
<input type="file" id="csvFile" accept=".csv">

<table>
<thead>
<tr>
<th>Pilih</th>
<th>Pasal</th>
<th>Keterangan</th>
<th>Hukuman</th>
<th>Denda</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div class="summary">
<h3>Ringkasan</h3>
<p><b>Total Tahanan:</b> <span id="totalTahanan">0</span></p>
<p><b>Total Denda:</b> <span id="totalDenda">0</span></p>
<p><b>Pasal Terpilih:</b> <span id="pasalTerpilih">-</span></p>
<button onclick="simpanHistori()">Simpan ke Histori</button>
</div>

<div class="history">
<h3>Histori Pelanggaran</h3>
<ul id="historyList"></ul>
</div>

<script>
const tableBody = document.getElementById('tableBody');
const totalTahananEl = document.getElementById('totalTahanan');
const totalDendaEl = document.getElementById('totalDenda');
const pasalTerpilihEl = document.getElementById('pasalTerpilih');
const historyList = document.getElementById('historyList');
let histori = [];

document.getElementById('csvFile').addEventListener('change', function (e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (ev) {
    tableBody.innerHTML = '';

    const text = ev.target.result
      .replace(/
/g, '')
      .trim();

    const lines = text.split('
');
    if (lines.length <= 1) return;

    for (let i = 1; i < lines.length; i++) {
      const rowData = lines[i].split(',');
      if (rowData.length < 4) continue;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" onchange="hitungTotal()"></td>
        <td>${rowData[0]}</td>
        <td>${rowData[1]}</td>
        <td>${rowData[3]}</td>
        <td>${rowData[2]}</td>
        <td>
          <button onclick="editRow(this)">Edit</button>
          <button onclick="deleteRow(this)">Hapus</button>
        </td>
      `;
      tableBody.appendChild(tr);
    }
  };
  reader.readAsText(file);
});

function hitungTotal() {
  let totalTahanan = 0;
  let totalDenda = 0;
  let totalBulan = 0;
  let pasal = [];

  document.querySelectorAll('#tableBody tr').forEach(r => {
    const cb = r.querySelector('input[type=checkbox]');
    if (!cb.checked) return;

    totalTahanan++;
    pasal.push(r.children[1].innerText);

    const denda = r.children[4].innerText.replace(/[^0-9]/g, '');
    totalDenda += parseInt(denda || '0');

    const bulan = r.children[3].innerText.replace(/[^0-9]/g, '');
    totalBulan += parseInt(bulan || '0');
  });

  totalTahananEl.innerText = totalTahanan;
  totalDendaEl.innerText = '$' + totalDenda;
  pasalTerpilihEl.innerText = pasal.join(', ') || '-';

  let bulanEl = document.getElementById('totalBulan');
  if (!bulanEl) {
    const p = document.createElement('p');
    p.innerHTML = '<b>Total Hukuman:</b> <span id="totalBulan">0</span> BULAN';
    document.querySelector('.summary').appendChild(p);
    bulanEl = document.getElementById('totalBulan');
  }
  bulanEl.innerText = totalBulan;
}

function deleteRow(btn) {
  btn.closest('tr').remove();
  hitungTotal();
}

function editRow(btn) {
  const r = btn.closest('tr');
  const p = prompt('Pasal', r.children[1].innerText);
  const k = prompt('Keterangan', r.children[2].innerText);
  const h = prompt('Hukuman (BULAN)', r.children[3].innerText);
  const d = prompt('Denda ($)', r.children[4].innerText);

  if (p !== null) r.children[1].innerText = p;
  if (k !== null) r.children[2].innerText = k;
  if (h !== null) r.children[3].innerText = h;
  if (d !== null) r.children[4].innerText = d;

  hitungTotal();
}

function simpanHistori() {
  histori.push({
    waktu: new Date().toLocaleString(),
    tahanan: totalTahananEl.innerText,
    denda: totalDendaEl.innerText,
    pasal: pasalTerpilihEl.innerText
  });

  historyList.innerHTML = '';
  histori.forEach((h, i) => {
    const li = document.createElement('li');
    li.textContent = `${i + 1}. [${h.waktu}] Tahanan: ${h.tahanan}, Denda: ${h.denda}, Pasal: ${h.pasal}`;
    historyList.appendChild(li);
  });
}
</script>

</body>
</html>
